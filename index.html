<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Feud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            background-color: #F1F3F4;
            color: #3c4043;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .card {
            background-color: #FFFFFF;
            border-radius: 1rem;
            border: 1px solid #DADCE0;
            padding: 0.75rem;
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.302), 0 2px 6px 2px rgba(60,64,67,0.149);
        }

        .btn-press {
             transition: transform 0.1s ease, filter 0.1s ease;
        }

        .btn-press:active {
            transform: scale(0.95);
            filter: brightness(0.9);
        }

        .answer-card {
            background-color: transparent; /* Container is now transparent */
            border-radius: 0.75rem;
            cursor: pointer;
            perspective: 1000px; /* Added for 3D effect */
            transition: all 0.4s ease;
            position: relative;
            height: 100%;
            opacity: 0;
            transform: scale(0.5);
            animation: pop-in 0.5s ease-out forwards;
        }
        
        .answer-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .answer-card.revealed .answer-card-inner {
            transform: rotateY(180deg);
        }
        
        .answer-card .front, .answer-card .back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
        }
        
        .answer-card .front {
            background-color: #E8EAED;
            color: #3c4043;
        }

        .answer-card .back {
            background-color: #4285F4;
            color: white;
            padding: 1rem;
            transform: rotateY(180deg);
        }
        
        /* Keyframe Animations */
        @keyframes pop-in {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes content-fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes score-increase-anim {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); color: #10B981; } /* Bright Green */
            100% { transform: scale(1); }
        }

        @keyframes score-decrease-anim {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); color: #EF4444; } /* Bright Red */
            100% { transform: scale(1); }
        }

        .content-fade-in {
            animation: content-fade-in 0.4s ease-out;
        }

        .score-increase {
            animation: score-increase-anim 0.6s ease-in-out;
        }
        
        .score-decrease {
            animation: score-decrease-anim 0.6s ease-in-out;
        }

    </style>
</head>
<body class="p-2 flex items-center justify-center min-h-screen">

    <main class="w-full max-w-5xl h-full mx-auto grid grid-cols-1 lg:grid-cols-6 gap-2">
        
        <!-- Left Column: Teams -->
        <div id="teamsContainer" class="col-span-1 space-y-2 flex flex-col">
            <!-- Team cards will be dynamically generated here -->
        </div>

        <!-- Center Column: Game Board -->
        <div class="lg:col-span-4 flex flex-col gap-2">
            <div id="questionDisplayCard" class="card flex-grow flex flex-col items-center justify-center p-4 min-h-[100px]">
                <!-- Question/Welcome message will go here -->
            </div>
            <div id="answerBoard" class="card flex-grow flex flex-col p-4 min-h-[300px]">
                <!-- Answers or Start Button will go here -->
            </div>
        </div>

        <!-- Right Column: Controls -->
        <div class="col-span-1 space-y-2 flex flex-col">
            <div class="card text-center flex-grow">
                <h3 class="text-base font-medium text-gray-500 mb-1">Current Team</h3>
                <p id="currentTeamDisplay" class="text-2xl font-bold text-blue-600">-</p>
            </div>
            <div class="card text-center flex-grow">
                <h3 class="text-base font-medium text-gray-500 mb-1">Time Left</h3>
                <p id="timerDisplay" class="text-5xl font-bold text-red-600">00</p>
            </div>
            <div id="endGameButton" class="card text-center flex-grow flex items-center justify-center cursor-pointer hover:bg-red-100 transition-colors btn-press">
                <h3 class="text-lg font-bold text-red-600">End Game</h3>
            </div>
        </div>

    </main>
    
    <!-- Audio elements -->
    <audio id="backgroundMusic" src="bg.mp3" preload="auto" loop></audio>
    <audio id="rightSound" src="rightding.mp3" preload="auto"></audio>
    <audio id="wrongSound" src="wrong.mp3" preload="auto"></audio>
    <audio id="drumSound" src="drum.mp3" preload="auto"></audio>

<script>
    // --- GAME STATE ---
    let teamScores = {};
    let currentRound = 0;
    let revealedAnswers = [];
    let currentTeamIndex = 0;
    let teamsPlayedThisRound = new Set();
    let gameState = 'IDLE'; // IDLE, NORMAL, STEAL, STEAL_ATTEMPT, REVEAL_STEAL, ROUND_OVER
    let stealingTeamIndex = null;
    let timerInterval = null;
    let missesThisRound = 0;

    // --- STATIC DATA ---
    const teams = [
        { name: 'Performance Patriots', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/1.png' },
        { name: 'Impression Invaders', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/2.png' },
        { name: 'Xtreme Optimizers', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/3.png' },
        { name: 'Engagement Experts', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/5.png' },
        { name: 'Lead Legends', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/4.png' }
    ];

    const feudQuestions = [
        { question: "What signals does broad match consider?", answers: [{ text: "Current Keyword" }, { text: "Landing Pages" }, { text: "Other Keywords in the ad group" }, { text: "Previous User Searches" }, { text: "Predicted Performance" }, { text: "User Location" }] },
        { question: "Which tools help find keywords for an advertiser?", answers: [{ text: "CBX // Top Terms Report" }, { text: "KW Refinery" }, { text: "KW Planner" }, { text: "Answer the Public" }, { text: "Pmax Insights - Max Magic Tool" }, { text: "Optiscore Reccos" }, { text: "Keywave" }] },
        { question: "What are best practices for implementing broad match?", answers: [{ text: "Use Smart Bidding" }, { text: "Add Negative Keywords" }, { text: "Add duplicate keywords in BM version" }, { text: "Test & Implement - Drafts & Experiments" }, { text: "Not Budget Constrained" }, { text: "Use UTM tracking for lead quality" }] },
        { question: "What are the important components / features of AI Max?", answers: [{ text: "Keywordless matching / Search Term matching" }, { text: "Automatically created assets" }, { text: "URL Expansion" }, { text: "Location Targeting at ad group level" }, { text: "Robust & Transparent Reporting" }] },
        { question: "What are some new Search & Pmax features?", answers: [{ text: "Ads Opportunities / User Searches" }, { text: "AI Overview" }, { text: "AI Mode" }, { text: "Search Smart Bidding Exploration" }, { text: "Retention Goals on Pmax" }, { text: "Age & Gender Exclusion" }, { text: "Channel Reporting" }, { text: "iOS targeting" }, { text: "OS / Device Exclusion" }, { text: "First Party Audience Exclusion" }, { text: "Pmax Search Terms Reporting" }, { text: "Flighted Budgets in Pmax" }] },
        { question: "What kind of benchmarks to consider to understand the search competition for your advertiserâ€™s search campaigns? ", answers: [{ text: "Impression Share / Ad Rank" }, { text: "Clickthrough Rates" }, { text: "Cost Per Click" }, { text: "Click Share" }, { text: "Peer Set average spend" }, { text: "Auction Insights" }] },
        { question: "How can we improve search impression share?", answers: [{ text: "Unconstrained Bids" }, { text: "Unconstrained budgets" }, { text: "Improve CTR" }, { text: "Improve Landing Page experience" }, { text: "Improve ad relevance" }, { text: "Refine / Add Negative Keywords" }, { text: "Asset Quality / Ad strength" }] },
        { question: "What signals does Gboost consider? What campaigns are eligible?", answers: [{ text: "Overpacing Campaign" }, { text: "Campaign performance" }, { text: "Search" }, { text: "Pmax" }, { text: "Shopping" }, { text: "App" }] },
        { question: "How to improve lead quality?", answers: [{ text: "Search Term / Keyword Audit" }, { text: "Landing Page Audit" }, { text: "UTM Tracking" }, { text: "Lead Scoring" }, { text: "QVT" }, { text: "EC4L / OCI" }, { text: "Network Serving (Search Partners)" }, { text: "Bid Restrictions" }, { text: "Ad Audit" }] },
        { question: "What are the highlights in new search metrics?", answers: [{ text: "Queries are deprecated" }, { text: "Ads Opportunities" }, { text: "User Searches" }, { text: "User Searches are indexed" }, { text: "Text + Shopping is 1 Ad opportunity" }, { text: "AI Overview is 1 Ad opportunity" }, { text: "AI Mode is 1 ad opportunity" }] }
    ];

    // --- DOM ELEMENTS CACHING ---
    const teamsContainer = document.getElementById('teamsContainer');
    const questionDisplayCard = document.getElementById('questionDisplayCard');
    const answerBoard = document.getElementById('answerBoard');
    const currentTeamDisplay = document.getElementById('currentTeamDisplay');
    const timerDisplay = document.getElementById('timerDisplay');
    const endGameButton = document.getElementById('endGameButton');
    
    // --- AUDIO ELEMENTS CACHING ---
    const backgroundMusic = document.getElementById('backgroundMusic');
    const rightSound = document.getElementById('rightSound');
    const wrongSound = document.getElementById('wrongSound');
    const drumSound = document.getElementById('drumSound');

    // --- UTILITY FUNCTIONS ---
    function playAudio(audioElement) {
        audioElement.currentTime = 0;
        audioElement.play().catch(error => console.error(`Audio playback failed: ${error}`));
    }
    
    function updateDisplay(element, newHtml) {
        element.classList.remove('content-fade-in');
        void element.offsetWidth; // Trigger a reflow to restart the animation
        element.innerHTML = newHtml;
        element.classList.add('content-fade-in');
    }

    // --- RENDER FUNCTIONS ---
    function renderTeams() {
        teamsContainer.innerHTML = '';
        teams.forEach((team, index) => {
            const teamCard = document.createElement('div');
            const score = teamScores[team.name] || 0; 
            const isActive = index === currentTeamIndex && gameState === 'NORMAL';
            teamCard.className = `card p-2 transition-all duration-300 ${isActive ? 'ring-4 ring-blue-400' : ''}`;
            teamCard.innerHTML = `
                <div class="flex items-center gap-2 w-full">
                    <img src="${team.logoUrl}" alt="${team.name} Logo" class="w-8 h-8 object-contain" onerror="this.src='https://placehold.co/40x40/E8EAED/3c4043?text=G'">
                    <div class="flex-grow">
                        <p class="text-sm font-bold">${team.name}</p>
                        <p class="score-display-${index} text-xl font-bold text-green-600 transition-colors duration-300">${score}</p>
                    </div>
                </div>
                <div class="flex items-center justify-end gap-1 mt-1 w-full">
                    <button class="w-6 h-6 flex items-center justify-center rounded-full bg-green-100 text-green-700 hover:bg-green-200 transition-colors text-base font-bold btn-press" onclick="manualAdjustScore(${index}, 10)" title="Add 10 points">+</button>
                    <button class="w-6 h-6 flex items-center justify-center rounded-full bg-red-100 text-red-700 hover:bg-red-200 transition-colors text-base font-bold btn-press" onclick="manualAdjustScore(${index}, -10)" title="Subtract 10 points">-</button>
                </div>
            `;
            teamsContainer.appendChild(teamCard);
        });
    }

    function renderAnswerBoard() {
        const roundData = feudQuestions[currentRound];
        const questionHTML = `
            <p class="text-sm font-medium text-blue-600 mb-1">Round ${currentRound + 1}</p>
            <h2 class="text-2xl font-bold text-center">${roundData.question}</h2>
        `;
        updateDisplay(questionDisplayCard, questionHTML);
        let boardHTML = `<div class="flex flex-col h-full w-full">`;
        boardHTML += `<div class="grid grid-cols-2 gap-3 w-full flex-grow">`;
        roundData.answers.forEach((answer, index) => {
            const isRevealed = revealedAnswers.includes(index);
            boardHTML += `
                <div class="answer-card ${isRevealed ? 'revealed' : ''}" onclick="revealAnswer(${index})" style="animation-delay: ${index * 0.05}s">
                    <div class="answer-card-inner">
                        <div class="front">
                            <span class="text-2xl font-bold">${index + 1}</span>
                        </div>
                        <div class="back">
                            <span class="text-lg font-semibold text-center">${answer.text}</span>
                        </div>
                    </div>
                </div>
            `;
        });
        boardHTML += `</div>`;
        
        boardHTML += `<div id="action-buttons" class="mt-4 flex-shrink-0">`;
        if (gameState === 'NORMAL') {
            boardHTML += `<button onclick="passTurn()" class="w-full bg-gray-500 text-white font-bold py-3 rounded-lg text-xl btn-press">Pass Turn</button>`;
        } else if (gameState === 'ROUND_OVER') {
            boardHTML += `<button onclick="nextRound()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg text-xl btn-press">Next Question</button>`;
        }
        boardHTML += `</div>`;

        boardHTML += `</div>`;
        answerBoard.innerHTML = boardHTML;
    }

    function showStartScreen() {
        gameState = 'IDLE';
        updateDisplay(questionDisplayCard, `<h2 class="text-3xl font-bold">Search Storm</h2>`);
        const startHTML = `
            <div class="text-center h-full flex flex-col items-center justify-center">
                <p class="text-lg text-gray-500 mt-2">Get ready for the challenge!</p>
                <button id="startGameBtn" class="mt-4 bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-105 btn-press">
                    Start Game
                </button>
            </div>
        `;
        updateDisplay(answerBoard, startHTML);
        document.getElementById('startGameBtn').addEventListener('click', () => {
             if (backgroundMusic.paused) {
                   backgroundMusic.play().catch(e => console.error("BG music failed to play:", e));
             }
             startRound();
        });
        currentTeamDisplay.textContent = "-";
        timerDisplay.textContent = "00";
        renderTeams();
    }

    // --- GAME LOGIC ---
    window.revealAnswer = (index) => {
        if (revealedAnswers.includes(index) || gameState === 'IDLE' || gameState === 'ROUND_OVER') return;
        
        if (gameState === 'NORMAL') {
            stopTimer();
            revealedAnswers.push(index);
            playAudio(rightSound);
            adjustScore(currentTeamIndex, 10);
            renderAnswerBoard();
            checkNormalRoundContinuation();
        } else if (gameState === 'REVEAL_STEAL') {
            revealedAnswers.push(index);
            renderAnswerBoard();
            // After revealing a steal answer, immediately check what's next.
            checkStealContinuation();
        }
    };

    function checkNormalRoundContinuation() {
        if (revealedAnswers.length >= 5) {
            endRound();
        } else {
            nextTurn();
        }
    }

    window.passTurn = () => {
        if (gameState === 'NORMAL') {
            stopTimer();
            playAudio(wrongSound);
            missesThisRound++;
            nextTurn();
        }
    };
    
    function nextTurn() {
        teamsPlayedThisRound.add(currentTeamIndex);

        if (teamsPlayedThisRound.size >= teams.length) {
            enterStealMode();
        } else {
            currentTeamIndex = (currentTeamIndex + 1) % teams.length;
            updateActiveTeamUI();
            startTimer(30);
        }
    }

    function enterStealMode() {
        playAudio(drumSound); // Play drum roll for steal round!
        gameState = 'STEAL';
        
        // Simplified: The steal round now only happens once per round if conditions are met.
        const remainingAnswers = feudQuestions[currentRound].answers.length - revealedAnswers.length;
        if (remainingAnswers === 0) {
            endRound();
            return;
        }

        let stealHTML = `<div class="text-center">
            <h3 class="text-2xl font-bold text-purple-600">STEAL ROUND!</h3>
            <p class="text-lg">Which team is attempting the steal?</p>
            <div class="flex justify-center flex-wrap gap-2 mt-2">`;
        
        teams.forEach((team, index) => {
            stealHTML += `<button onclick="attemptSteal(${index})" class="p-2 bg-gray-200 rounded-lg btn-press"><img src="${team.logoUrl}" class="w-10 h-10"></button>`;
        });

        stealHTML += `</div><button onclick="noSteal()" class="mt-4 w-full bg-yellow-500 text-white font-bold py-3 rounded-lg text-lg btn-press">No Steal</button></div>`;
        updateDisplay(questionDisplayCard, stealHTML);
        currentTeamDisplay.textContent = "Steal!";
        document.getElementById('action-buttons').innerHTML = '';
    }

    window.attemptSteal = (teamIndex) => {
        gameState = 'STEAL_ATTEMPT';
        stealingTeamIndex = teamIndex;
        const currentQuestion = feudQuestions[currentRound].question;
        
        let attemptHTML = `<div class="text-center">
            <p class="text-sm font-medium text-blue-600 mb-1">Round ${currentRound + 1}</p>
            <h2 class="text-xl font-semibold mb-2">${currentQuestion}</h2>
            <hr class="my-2">
            <h3 class="text-xl font-bold mt-2">Steal attempt by ${teams[teamIndex].name}</h3>
            <p>Was their answer right or wrong?</p>
            <div class="flex justify-center gap-4 mt-2">
                <button onclick="handleSteal(true)" class="bg-green-500 text-white font-bold py-2 px-6 rounded-lg text-lg btn-press">Right (+5)</button>
                <button onclick="handleSteal(false)" class="bg-red-500 text-white font-bold py-2 px-6 rounded-lg text-lg btn-press">Wrong (-5)</button>
            </div>
        </div>`;
        updateDisplay(questionDisplayCard, attemptHTML);
        startTimer(15);
    };

    window.noSteal = () => {
        endRound();
    };

    function handleSteal(isCorrect) {
        stopTimer();
        // missesThisRound is no longer needed to control steal rounds.
        
        if (isCorrect) {
            gameState = 'REVEAL_STEAL';
            playAudio(rightSound);
            adjustScore(stealingTeamIndex, 5);
            updateDisplay(questionDisplayCard, `<h3 class="text-xl font-bold text-center">Correct! Reveal the answer on the board.</h3>`);
        } else {
            playAudio(wrongSound);
            adjustScore(stealingTeamIndex, -5);
            checkStealContinuation(); // If wrong, immediately check what to do next.
        }
    }
    
    function checkStealContinuation() {
        // Simplified: After one steal attempt (correct or not), the round ends.
        endRound();
    }

    function endRound() {
        gameState = 'ROUND_OVER';
        stopTimer();
        currentTeamDisplay.textContent = "Round Over";

        // Auto-reveal all remaining answers
        const allAnswerIndexes = feudQuestions[currentRound].answers.map((_, i) => i);
        allAnswerIndexes.forEach(index => {
            if (!revealedAnswers.includes(index)) {
                revealedAnswers.push(index);
            }
        });
        
        // This will render the board with all answers revealed
        // and will also show the "Next Question" button because gameState is 'ROUND_OVER'
        renderAnswerBoard();
    }

    function nextRound() {
        currentRound++;
        if (currentRound >= feudQuestions.length) {
            endGame();
        } else {
            startRound();
        }
    }

    function endGame() {
        stopTimer();
        backgroundMusic.pause();
        backgroundMusic.currentTime = 0;
        gameState = 'IDLE';
        let highestScore = -Infinity;
        let winners = [];

        for (const teamName in teamScores) {
            if (teamScores[teamName] > highestScore) {
                highestScore = teamScores[teamName];
                winners = [teamName];
            } else if (teamScores[teamName] === highestScore) {
                winners.push(teamName);
            }
        }

        let winnerMessage;
        if (winners.length > 1) {
            winnerMessage = `It's a tie between ${winners.join(' & ')}!`;
        } else if (winners.length === 1) {
            winnerMessage = `${winners[0]} wins the game!`;
        } else {
            winnerMessage = "Good game, everyone!";
        }

        updateDisplay(questionDisplayCard, `<h2 class="text-4xl font-bold text-center">Game Over!</h2>`);
        const endHTML = `
            <div class="text-center h-full flex flex-col items-center justify-center">
                <p class="text-2xl text-blue-600 mt-2">${winnerMessage}</p>
                <p class="text-xl text-gray-500 mt-2">Final Score: ${highestScore}</p>
                <button onclick="initializeGame()" class="mt-4 bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-105 btn-press">
                    Play Again
                </button>
            </div>
        `;
        updateDisplay(answerBoard, endHTML);
        currentTeamDisplay.textContent = 'Finished';
    }

    function updateActiveTeamUI() {
        currentTeamDisplay.textContent = teams[currentTeamIndex].name;
        renderTeams();
    }
    
    function adjustScore(teamIndex, points) {
        const teamName = teams[teamIndex].name;
        teamScores[teamName] = (teamScores[teamName] || 0) + points;
        renderTeams();

        const scoreElement = document.querySelector(`.score-display-${teamIndex}`);
        if(scoreElement) {
            const animationClass = points > 0 ? 'score-increase' : 'score-decrease';
            scoreElement.classList.add(animationClass);
            setTimeout(() => {
                scoreElement.classList.remove(animationClass);
            }, 600);
        }
    }

    window.manualAdjustScore = (teamIndex, points) => {
        adjustScore(teamIndex, points);
    }

    function initializeGame() {
        teams.forEach(team => {
            teamScores[team.name] = 0;
        });
        currentRound = 0;
        showStartScreen();
    }

    function startRound() {
        gameState = 'NORMAL';
        currentTeamIndex = currentRound % teams.length; // Rotate starting team
        revealedAnswers = [];
        teamsPlayedThisRound.clear();
        missesThisRound = 0;
        
        renderAnswerBoard();
        updateActiveTeamUI();
        startTimer(30);
    }
    
    // --- TIMER FUNCTIONS ---
    function startTimer(duration) {
        clearInterval(timerInterval);
        let timeLeft = duration;
        timerDisplay.textContent = String(timeLeft).padStart(2, '0');
        timerInterval = setInterval(() => {
            timeLeft--;
            timerDisplay.textContent = String(timeLeft).padStart(2, '0');
            if (timeLeft <= 0) {
                stopTimer();
                if (gameState === 'NORMAL') {
                    passTurn();
                } else if (gameState === 'STEAL_ATTEMPT') {
                    handleSteal(false);
                }
            }
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        timerDisplay.textContent = "00";
    }

    function setupAudio() {
        // Set volumes for a balanced audio experience
        backgroundMusic.volume = 0.1; // Low for background ambiance
        rightSound.volume = 0.5;      // Clear but not overpowering
        wrongSound.volume = 0.4;      // Slightly softer than the "right" sound
        drumSound.volume = 0.6;       // A bit more impactful for the steal round event
    }

    // Initial load
    window.onload = () => {
        setupAudio();
        initializeGame();
    };
    
    endGameButton.addEventListener('click', endGame);

</script>
</body>
</html>

